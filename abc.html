<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>远远货币价格监控系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .navbar-brand { font-weight: bold; font-size: 1.5rem; }
        .card { border: none; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .card-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px 10px 0 0 !important; border: none; }
        .card.bg-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important; }
        .card.bg-success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%) !important; }
        .card.bg-info { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important; }
        .card.bg-warning { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important; }
        .table th { background-color: #f8f9fa; border-top: none; font-weight: 600; color: #495057; }
        .table td { vertical-align: middle; border-top: 1px solid #dee2e6; }
        .table-hover tbody tr:hover { background-color: rgba(0,123,255,0.1); }
        .price-up { color: #28a745; font-weight: bold; }
        .price-down { color: #dc3545; font-weight: bold; }
        .price-neutral { color: #6c757d; }
        .price-number { font-family: 'Courier New', monospace; font-weight: bold; }
        .navbar { box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .navbar-brand { color: #fff !important; }
        .nav-link { color: rgba(255,255,255,0.8) !important; transition: color 0.3s ease; }
        .nav-link:hover { color: #fff !important; }
        #priceChart, #detailedChart { border-radius: 8px; background-color: #fff; }
        .status-indicator { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .status-online { background-color: #28a745; }
        .status-offline { background-color: #dc3545; }
        .loading { text-align: center; padding: 20px; }
        .spinner-border-sm { width: 1rem; height: 1rem; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-coins"></i> 胖墩的加密货币监控系统
            </a>
            <div class="navbar-nav ms-auto">
                <span class="nav-link" id="statusIndicator">
                    <span class="status-indicator status-online"></span>
                    <span id="lastUpdate">正在加载实时数据...</span>
                </span>
                <a class="nav-link" href="#" onclick="updateData()">
                    <i class="fas fa-sync-alt"></i> 刷新
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- 统计信息卡片 -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-title">总市值</h6>
                                <h4 id="totalMarketCap">$0</h4>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-chart-line fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-title">24h交易量</h6>
                                <h4 id="totalVolume">$0</h4>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-exchange-alt fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-title">上涨币种</h6>
                                <h4 id="gainers">0</h4>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-arrow-up fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-title">下跌币种</h6>
                                <h4 id="losers">0</h4>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-arrow-down fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主要内容区域 -->
        <div class="row">
            <!-- 价格表格 -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-list"></i> 实时价格</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover" id="priceTable">
                                <thead>
                                    <tr>
                                        <th>币种</th>
                                        <th>价格 (USD)</th>
                                        <th>价格 (CNY)</th>
                                        <th>24h涨跌</th>
                                        <th>市值</th>
                                    </tr>
                                </thead>
                                <tbody id="priceTableBody">
                                    <tr>
                                        <td colspan="5" class="loading">
                                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                                                <span class="visually-hidden">加载中...</span>
                                            </div>
                                            正在获取实时数据...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 图表区域 -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-area"></i> 市值排名</h5>
                    </div>
                    <div class="card-body">
                        <div id="priceChart" style="height: 400px;">
                            <div class="loading">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">加载中...</span>
                                </div>
                                <p>正在加载图表...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 详细图表区域 -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-line"></i> 价格趋势分析</h5>
                    </div>
                    <div class="card-body">
                        <div id="detailedChart" style="height: 500px;">
                            <div class="loading">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">加载中...</span>
                                </div>
                                <p>正在加载趋势图...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentData = [];
        let updateInterval;
        
        function formatNumber(num, decimals = 2) {
            if (num >= 1e12) return (num / 1e12).toFixed(decimals) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(decimals) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(decimals) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(decimals) + 'K';
            return num.toFixed(decimals);
        }
        
        function formatPrice(price) {
            return '$' + formatNumber(price, 2);
        }
        
        function formatMarketCap(marketCap) {
            return '$' + formatNumber(marketCap, 2);
        }
        
        function getPriceChangeClass(change) {
            if (change > 0) return 'price-up';
            if (change < 0) return 'price-down';
            return 'price-neutral';
        }
        
        function getPriceChangeIcon(change) {
            if (change > 0) return '<i class="fas fa-arrow-up"></i>';
            if (change < 0) return '<i class="fas fa-arrow-down"></i>';
            return '<i class="fas fa-minus"></i>';
        }
        
        function updateTable(data) {
            const tbody = document.getElementById('priceTableBody');
            tbody.innerHTML = '';
            
            data.forEach(coin => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <strong>${coin.name}</strong><br>
                        <small class="text-muted">${coin.symbol}</small>
                    </td>
                    <td class="price-number">${formatPrice(coin.price_usd)}</td>
                    <td class="price-number">¥${formatNumber(coin.price_cny, 2)}</td>
                    <td class="${getPriceChangeClass(coin.change_24h)}">
                        ${getPriceChangeIcon(coin.change_24h)}
                        ${coin.change_24h ? coin.change_24h.toFixed(2) + '%' : 'N/A'}
                    </td>
                    <td class="price-number">${formatMarketCap(coin.market_cap)}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function updateChart(data) {
            const chartData = [{
                x: data.map(coin => coin.name),
                y: data.map(coin => coin.market_cap / 1e9), // 转换为十亿美元
                type: 'bar',
                marker: {
                    color: data.map(coin => coin.change_24h > 0 ? '#28a745' : '#dc3545')
                }
            }];
            
            const layout = {
                title: '市值排名 (十亿美元)',
                xaxis: { title: '币种' },
                yaxis: { title: '市值 (十亿美元)' },
                margin: { t: 50, r: 30, b: 50, l: 50 }
            };
            
            Plotly.newPlot('priceChart', chartData, layout, {responsive: true});
        }
        
        function updateDetailedChart(data) {
            // 生成模拟的历史数据
            const dates = [];
            const prices = [];
            const volumes = [];
            
            for (let i = 0; i < 30; i++) {
                const date = new Date();
                date.setDate(date.getDate() - (29 - i));
                dates.push(date.toISOString().split('T')[0]);
                
                // 基于当前价格生成历史数据
                const basePrice = data[0] ? data[0].price_usd : 45000;
                const variation = (Math.random() - 0.5) * 0.1; // ±5% 变化
                prices.push(basePrice * (1 + variation));
                
                const baseVolume = data[0] ? data[0].volume_24h : 1000000000;
                volumes.push(baseVolume * (0.8 + Math.random() * 0.4));
            }
            
            const trace1 = {
                x: dates,
                y: prices,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Bitcoin价格',
                yaxis: 'y',
                line: { color: '#007bff' }
            };
            
            const trace2 = {
                x: dates,
                y: volumes,
                type: 'bar',
                name: '交易量',
                yaxis: 'y2',
                marker: { color: 'rgba(0,123,255,0.3)' }
            };
            
            const layout = {
                title: 'Bitcoin 价格趋势 (30天)',
                xaxis: { title: '日期' },
                yaxis: { title: '价格 (USD)', side: 'left' },
                yaxis2: { title: '交易量', side: 'right', overlaying: 'y' },
                margin: { t: 50, r: 50, b: 50, l: 50 }
            };
            
            Plotly.newPlot('detailedChart', [trace1, trace2], layout, {responsive: true});
        }
        
        function updateStats(data) {
            const totalMarketCap = data.reduce((sum, coin) => sum + (coin.market_cap || 0), 0);
            const totalVolume = data.reduce((sum, coin) => sum + (coin.volume_24h || 0), 0);
            const gainers = data.filter(coin => coin.change_24h > 0).length;
            const losers = data.filter(coin => coin.change_24h < 0).length;
            
            document.getElementById('totalMarketCap').textContent = formatMarketCap(totalMarketCap);
            document.getElementById('totalVolume').textContent = formatMarketCap(totalVolume);
            document.getElementById('gainers').textContent = gainers;
            document.getElementById('losers').textContent = losers;
            
            const now = new Date();
            document.getElementById('lastUpdate').textContent = '最后更新: ' + now.toLocaleTimeString();
        }
        
        async function fetchRealData() {
            try {
                // 使用CoinGecko API获取实时数据
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,binancecoin,cardano,solana,polkadot,dogecoin,avalanche-2,chainlink,litecoin&vs_currencies=usd,cny&include_24hr_change=true&include_24hr_vol=true&include_market_cap=true');
                
                if (!response.ok) {
                    throw new Error('网络请求失败');
                }
                
                const data = await response.json();
                
                // 转换数据格式
                const coinNames = {
                    'bitcoin': 'Bitcoin',
                    'ethereum': 'Ethereum',
                    'binancecoin': 'BNB',
                    'cardano': 'Cardano',
                    'solana': 'Solana',
                    'polkadot': 'Polkadot',
                    'dogecoin': 'Dogecoin',
                    'avalanche-2': 'Avalanche',
                    'chainlink': 'Chainlink',
                    'litecoin': 'Litecoin'
                };
                
                const coinSymbols = {
                    'bitcoin': 'BTC',
                    'ethereum': 'ETH',
                    'binancecoin': 'BNB',
                    'cardano': 'ADA',
                    'solana': 'SOL',
                    'polkadot': 'DOT',
                    'dogecoin': 'DOGE',
                    'avalanche-2': 'AVAX',
                    'chainlink': 'LINK',
                    'litecoin': 'LTC'
                };
                
                const formattedData = [];
                for (const [coinId, priceData] of Object.entries(data)) {
                    formattedData.push({
                        id: coinId,
                        name: coinNames[coinId] || coinId,
                        symbol: coinSymbols[coinId] || coinId.toUpperCase(),
                        price_usd: priceData.usd || 0,
                        price_cny: priceData.cny || 0,
                        change_24h: priceData.usd_24h_change || 0,
                        volume_24h: priceData.usd_24h_vol || 0,
                        market_cap: priceData.usd_market_cap || 0,
                        timestamp: new Date().toISOString()
                    });
                }
                
                return formattedData;
                
            } catch (error) {
                console.error('获取实时数据失败:', error);
                // 返回示例数据作为备用
                return getSampleData();
            }
        }
        
        function getSampleData() {
            return [
                {
                    id: 'bitcoin',
                    name: 'Bitcoin',
                    symbol: 'BTC',
                    price_usd: 45000.0,
                    price_cny: 300000.0,
                    change_24h: 2.5,
                    volume_24h: 1000000000,
                    market_cap: 800000000000,
                    timestamp: new Date().toISOString()
                },
                {
                    id: 'ethereum',
                    name: 'Ethereum',
                    symbol: 'ETH',
                    price_usd: 3200.0,
                    price_cny: 22000.0,
                    change_24h: -1.2,
                    volume_24h: 800000000,
                    market_cap: 400000000000,
                    timestamp: new Date().toISOString()
                },
                {
                    id: 'binancecoin',
                    name: 'BNB',
                    symbol: 'BNB',
                    price_usd: 320.0,
                    price_cny: 2200.0,
                    change_24h: 0.8,
                    volume_24h: 200000000,
                    market_cap: 50000000000,
                    timestamp: new Date().toISOString()
                },
                {
                    id: 'cardano',
                    name: 'Cardano',
                    symbol: 'ADA',
                    price_usd: 0.45,
                    price_cny: 3.2,
                    change_24h: 3.2,
                    volume_24h: 150000000,
                    market_cap: 15000000000,
                    timestamp: new Date().toISOString()
                },
                {
                    id: 'solana',
                    name: 'Solana',
                    symbol: 'SOL',
                    price_usd: 95.0,
                    price_cny: 650.0,
                    change_24h: -2.1,
                    volume_24h: 300000000,
                    market_cap: 40000000000,
                    timestamp: new Date().toISOString()
                }
            ];
        }
        
        async function loadData() {
            try {
                const data = await fetchRealData();
                currentData = data;
                
                updateTable(data);
                updateChart(data);
                updateDetailedChart(data);
                updateStats(data);
                
                // 更新状态指示器
                const statusIndicator = document.querySelector('.status-indicator');
                statusIndicator.className = 'status-indicator status-online';
                
            } catch (error) {
                console.error('加载数据失败:', error);
                showMessage('加载数据失败，使用示例数据', 'warning');
                
                const data = getSampleData();
                currentData = data;
                updateTable(data);
                updateChart(data);
                updateDetailedChart(data);
                updateStats(data);
            }
        }
        
        function updateData() {
            showMessage('正在更新数据...', 'info');
            loadData();
        }
        
        function showMessage(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alertDiv);
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 3000);
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            
            // 每30秒自动刷新
            updateInterval = setInterval(loadData, 30000);
            
            showMessage('系统已启动，正在获取实时数据...', 'success');
        });
        
        // 页面卸载时清理定时器
        window.addEventListener('beforeunload', function() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
    </script>
</body>
</html>
